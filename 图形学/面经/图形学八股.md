# 3D 数学
## 齐次坐标的作用

![[3D数学#^qctphb]]
## 欧拉角
[[01 三维旋转#欧拉角]]

**一共有 3 种欧拉角：俯仰角 (Pitch)、偏航角 (Yaw)和滚转角 (Roll)**
inspector 界面上显示的 Rotation 的 XYZ 值都是欧拉角
Untiy 欧拉角常用顺规：YXZ（Yaw-pitch-Roll）

**使用欧拉角的两个缺点：**
1. 同一旋转表示不唯一，即欧拉角绕一个轴旋转 90° 和 450°结果是一样的
2. X 轴达到 90 度时会产生万向节死锁
**使用四元数可以解决这两个问题，四元数的旋转转换为欧拉角后可以发现对应的欧拉角范围为（-180~180），不会出现欧拉角的缺点一。**
## 四元数
[[01 三维旋转#四元数]]
**四元数构成**
一个四元数包含一个标量和一个 3D 向量 $[ v,w]$
其中 $v$  为 3D 向量, $w$ 为标量，即 $[(x, y, z),w]$

**对于给定的任意一个四元数: 表示 3D 空间中的一个旋转量**

> [!NOTE] 轴-角对
> 在 3D 空间中，任意旋转都可以表示绕着某个轴旋转一个旋转角得到
> 注意: 该轴是**局部空间**中的**任意一个轴**

对于给定旋转，假设为绕着 $n$ 轴，旋转 $β$ 度，$n$ 轴为 $(x, y, z)$ 那么可以构成四元数为
四元数 $Q= [\sin (β/2)*n,\cos (β/2)]$
四元数 $Q= [ \sin (β/2) *x, \sin (β/2) *y, \sin (β/2) *z,\cos (β/2)]$
**四元数 $Q$ 则表示绕着轴 $n$，旋转 $β$ 度的旋转量
## 万向节死锁
[[01 三维旋转#万向节死锁（Gimbal Lock）]]

# 图形学基础

## 齐次裁剪为什么要在透视除法前？**
[[02 空间变换#^xu4mwq]] 提到透视投影后，裁剪空间的 $w$ 值=观察空间深度值 $z$。如果观察空间深度值为 $z=0$，那么 $w=0$，透视除法除以 $w$ 就会发生除零错误。所以在透视除法之前必然要把这样的点裁剪掉，也就是透视除法之前做裁剪。


# 软光栅项目
## 画线算法


## 透视矫正插值
![](1672977119933.png)

本来按照正确的透视，正方形的中心点应该在 AC 和 BD 的交点 Q，我们应该把纹理中 uv 坐标为 $(\frac{1}{2},\frac{1}{2})$ 的颜色值赋给 Q，但是图中却赋给了 P。为什么呢？

原因：在屏幕空间的坐标计算三角形重心，插值运算在这个时候不会考虑近大远小，导致图像不正确的显示。

解决方法：用世界空间坐标计算三角形重心，TODO

现在基本由硬件自动处理。

## 视口变换矩阵bug
项目中的视口变换矩阵并不完整，视口矩阵负责从 NDC 空间转换到屏幕空间，在裁剪空间先完成裁剪，然后对裁剪坐标执行【透视除法】后就能变换到标准化设备坐标（NDC）。
然而项目中并没有执行透视除法 (除以 w 分量)，没有完成从裁剪空间到 NDC 空间的转换，直接就对裁剪空间的坐标进行了视口转换。

【修正方法】：我们在绘制三角形，判断边界以及计算重心的时候，都执行一次透视除法（除以z分量）

