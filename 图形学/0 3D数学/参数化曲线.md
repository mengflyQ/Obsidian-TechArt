使用一些关键点，来控制一条曲线的形状，是图形学和游戏中非常常见的需求，这里来看下常见的参数化曲线的描述方式。

## 多项式曲线

对于二维空间的 N 个点 (x 坐标值不同)，我们总可以找到一个 n-1 维的多项式方程，使得该多项式方程的曲线经过这 N 个点。

求解的方式比较简单，设现在有 N+1 个点 $[(x_0, y_0), (x_1, y_1,) \dots (x_n, y_n)]$ ，设多项式方程为 $y = k_0 + k_1 x + k_2x^2 + k_3x^3 + \dots + k_n x^n$ ，已知方程曲线经过这些点，可以列出矩阵方程为

$$\left( \begin {array} {ll} x_0 & x_0 ^2 & x_0^3 & \dots x_0^n \\ x_1 & x_1 ^2 & x_1^3 & \dots x_1^n \\ \vdots& \ddots&& \vdots \\ x_n& x_n ^2 & x_n^3 & \dots x_n^n \end {array} \right) \left( \begin {array} {} k_0\\k_1\\ \vdots \\ k_n \end {array} \right) = \left( \begin {array} {} y_0\\y_1\\ \vdots \\ y_n \end {array} \right) \tag{1}$$

左边的矩阵就是 **范德蒙 / Vandermonde** 矩阵，行列式值是非零的，因此方程组必然有唯一解。求解这个多项式方程组，就可以得到插值曲线。

当然，如果直接对这个矩阵方程进行求解，计算略微有些复杂。 实际计算时，我们常常会使用拉格朗日插值或者牛顿插值法来求解。这里来简单介绍下这两种插值方式：

### 拉格朗日 / Larange 插值

先来看一次线性插值和二次抛物线插值的简单情况。

已知区间 $[x_k, x_{k+1}]$ ，端点函数值为 $y_k = f(x_k), y_{k+1} = f(x_{k+1})$ 。现在要求线性插值多项式 $L_1(x)$ ，满足 $L(x_k) = y_k, L(x_{k+1}) = y_{k+1}$ 。

$y = L_1(x)$ 的几何意义， 就是过两个端点的直线，因此很容易求得 $y = L_1(x)$ 的表达式为：

点斜式两点式 

$$L_1(x) = y_k + \frac{y_{k+1} - y_k}{x_{k+1} - x_k}(x - x_k) (点斜式)\\ L_1(x) = y_k \frac{x_{k+1} - x}{x_{k+1} - x_k} + y_{k+1} \frac{x - x_k}{x_{k+1} - x_k} (两点式) $$

我们看两点式的表示形式， $L_1(x)$ 是由两个线性函数 $l_k =\frac{ x - x_{k+1} }{ x_k -x_{k+1} } ,l_{k+1} =\frac{ x - x_{k} }{ x_{k+1} - x_k }$ 线性组合得到，其系数分别是 $l_k ,l_{k+1}$ ，即：

$$L_1(x) = y_k l_k(x) + y_{k+1}l_{k+1}(x) $$

$l_k ,l_{k+1}$ 也是线性插值的多项式，在端点上满足：

$$l_k(x_k) = 1, l_k(x_{k+1}) = 0;\\ l_{k+1}(x_k) = 0, l_{k+1}(x_{k+1}) = 1;$$

![[8b3256c679d4294ed25f248e6c699ee6_MD5.png]]

当我们使用三个点进行多项式插值时，设插值点为 $x_{k-1}, x_k, x_{k+1}$ ，求二次插值多项式 $L_2(x)$ ，使得 $L_2(x_j) = y_j$ 。采用类似于前面的基函数的方式，我们要求出基函数 $l_{k-1}(x), l_{k}(x), l_{k+1}(x)$ ，已知这些基函数满足：

$l_{k-1}(x_{k-1}) = 1, l_{k-1}(x_{k}) = 0, l_{k-1}(x_{k+1}) = 0; \\ l_{k}(x_{k-1}) = 0, l_{k}(x_{k}) = 1, l_{k}(x_{k+1}) = 0; \\ l_{k+1}(x_{k-1}) = 0, l_{k+1}(x_{k}) = 0, l_{k+1}(x_{k+1}) = 1;$

满足这些条件的基函数很容易求出，例如对于 $l_{k-1}(x)$ ，有两个零点 $x_k, x_{k+1}$ , 可求得：

$$l_{k-1} (x) = \frac {(x - x_k)(x-x_{k+1})} { (x _{k-1}- x_k)(x_{k-1}-x_{k+1})}$$

同理可得：

$$l_{k} (x) = \frac {(x - x_{k-1})(x-x_{k+1})} { (x _{k}- x_{k-1})(x_{k}-x_{k+1})}\\ l_{k} (x) = \frac {(x - x_{k})(x-x_{k})} { (x _{k+1}- x_{k-1})(x_{k+1}-x_{k})}$$

这样就算出整体的插值函数为：

$$L_2(x) = y_{k-1}l_{k-1}(x) + y_{k}l_{k}(x) + y_{k+1}l_{k+1}(x) $$

![[34c7e5cf00c83dd9ef4a8fb6f9d67e7c_MD5.png]]

前面是一次和二次多项式的推导，将这种插值函数推广到一般情形，现有 n+1 个节点，求 n 次插值多项式 $L_n(x)$ ，满足

$$L_n(x_j) = y_j, j = 0, 1, 2,\dots, n $$

我们定义 n 次插值基函数 $l_j(x)$ ，满足

$$l_j(x_k) = \begin{cases} 1, k =j \\ 0, k \ne j \end{cases} $$

前面已经推导过 n=1 和 n=2 的情况，使用类似的推导方法，可以得到 n 次插值基函数为：

$$l_k(x) = \frac{ (x-x_0)\dots(x-x_{k-1})(x-x_{k+1})\dots(x-x_n)}{ (x_k-x_0)\dots(x_k-x_{k-1})(x_k-x_{k+1})\dots(x_k-x_n) }, k= 0, 1, \dots n \tag{2}$$

构造出多项式插值函数为：

$$L_n(x) = \sum_{k=0}^{n}{y_kl_k(x)} \tag{3}$$

多项式 $L_n$ 称为**拉格朗日多项式**。

### 牛顿插值

牛顿法插值使用一种不同的方式来计算多项式插值。

考虑两个点插值的情况，我们将插值多项式记为 $P_1(x)$ ，满足 $P_1(x_0) = f(x_0), P_1(x_1) = f(x_1)$ ，可得：

$$P_1(x) = f(x_0) + \frac{f(x_1) - f(x_0)}{x_1 - x_0}(x - x_0)$$

可以看成是对零次插值 $P_0(x) = f(x_0)$ 的修正：

$$P_1(x) = P_0(x) + a_1(x - x_0)$$

其中 $a_1 = \frac{f(x_1) - f(x_0)}{x_1 - x_0}$ 是函数 $f(x)$ 的**均差**。

同样，来看三点插值的多项式 $P_2(x)$ ，满足 $P_2(x_0) = f(x_0),P_2(x_1) = f(x_1),P_2(x_2) = f(x_2)$ ，

可以表示成：

$$P_2(x) = P_1(x) + a_2 (x-x_0)(x-x_1)$$

可以求出：

$$a_2 = \frac{P_2(x_2) - P_1(x_2)}{(x_2-x_0)(x_2-x_1)} = \frac{ \frac{f(x_2) - f(x_0)}{x_2 - x_0} - \frac{f(x_1) - f(x_0)}{x_1 - x_0} }{ x_2 - x_1 } $$

$a_2$ 是 $f(x)$ 的**二阶均差**。

使用归纳法可将多项式的表示扩展到一般形式：

令 $f[x_0, x_1] = = \frac{f(x_1) - f(x_0)}{x_1 - x_0}$ 为 $f(x)$ 关于点 $x_0, x_1$ 的**一阶均差**。

$f[x_0, x_1,x_2] = \frac{f[x_0, x_2] - f[x_0, x_1] }{x_2 - x_1}$ 为 $f(x)$ 的**二阶均差**。

$f[x_0, x_1, \cdots,x_k] = \frac{f[x_0, x_1, \cdots,x_{k-2}, x_k] - [x_0, x_1, \cdots,x_{k-1}] }{x_k - x_{k-1}}$ 为 $f(x)$ 的 **k 阶均差**。

牛顿插值多项式表示为：

$$P_1(x) = P_0(x) + f[x_0, x_1](x-x_0) = f(x_0) + f[x_0, x_1](x-x_0) \\ \begin{align}P_2(x) &= P_1(x) + f[x_0, x_1, x_2](x-x_0)(x-x_1)\\ &= f(x_0) +f[x_0, x_1](x-x_0) + f[x_0, x_1,x_2](x-x_0)(x-x_1)\\ \end{align}\\ P_n(x) = f(x_0) +f[x_0, x_1](x-x_0) + f[x_0, x_1,x_2](x-x_0)(x-x_1) + \cdots\\ + f[x_0, x_1, x_2+\cdots+x_n](x-x_0)\cdots(x-x_{n-1}) \tag{4}$$

$P_n(x)$ 叫做牛顿均差插值多项式。

对于相同的关键点，使用矩阵法、拉格朗日插值和牛顿插值计算出来的结果是相同的。

不过由于牛顿插值相对于拉格朗日插值有这样两个优点，使得其更加常见，尤其在计算机计算中：

*   增加删除关键点时，不用完全重新计算，部分计算中间结果可以复用；
*   计算量更小，参数次数较低，产生的误差也更小。

### 多项式曲线的参数化

直接使用多项式插值，得到 y 关于 x 的多项式函数时，有一点限制，就是必须保证 $x_0$ 到  $x_n$ 必须是严格递增的，对于下图中这样顺序的曲线，就无法直接使用一个多项式来进行拟合。

一种常用的处理手段，是将整个曲线，先进行参数化，对每个点计算出相应的参数 t，然后使用 x，y 分别对参数 t 求出拟合多项式出来。分别得到 x、y 关于 t 的多项式

![[e7ca390e301aa42a80be5df1b3e8d2f5_MD5.png]]

目前常用的参数化方式有这样几种：

均匀参数化 / uniform parameterization：每个点之间的参数变化量相等， $t_i = i$ ；

弦长参数化 / chordal parameterization：每两个点之间的参数值，等比于两个点之间的距离平方， $t_{i+1}- t_i = || k_{i+1} -  k_i||$ ；

中心参数化 / Centrietal parameterization：没两个点之间的参数值，等比于两点之间的平面距离， $t_{i+1}- t_i =\sqrt{ || k_{i+1} -  k_i||}$ 。

下面的示例，显示了不同的参数化方式，对曲线插值造成的影响。可以看出，不同的参数化方式，对结果的影响很大，我们在不同的情况下，需要选择合适的参数化方式来使用。

![[51d0f8abe74a8642b926a9564de7480e_MD5.jpg]]

## 分段的三次多项式插值

### 曲线分段的必要性

前面我们讲过的所有曲线插值，都是全局的曲线插值，也就是说，对任意一个点的位置进行修改，就会影响整个曲线的形状。而且点的个数很多时，多项式插值的次数会比较高，有的时候某些点的微小改变，都会对整个曲线形状产生较大影响。这样就产生了**病态问题**，也叫做**龙格现象**。

因此在很多时候，我们会使用分段形式的曲线，来实现曲线插值。也就是说，将每段之间的插值曲线，分别单独进行计算，这样距离较远的控制点，就无法再影响当前曲线段的形状。

### 分段三次插值

分段的三次多项式插值，是一种在实践中非常常见的插值方式。相对于二次多项式函数，三次函数可以表达出拐点信息。而四次多项式拐点较多，计算时容易出现误差，因此三次多项式是非常合适的用来表示曲线的函数。

对于一段三次曲线，要确定其形状，需要四个条件，除了两个端点的位置作为参数外，我们还需要两个参数。通常，我们会将两个端点的导数作为额外的参数。端点的导数可以是直接通过手动设置来给出。也可以使用相邻两个点的连线方向，作为默认导数的方向，如果端点位于两端，就使用二阶导数为 0，来作为末端点的额外条件。

![[eb762eefb50e0fdd65473792f1525dbc_MD5.jpg]]

分段三次曲线，是各种游戏编辑器和曲线编辑器中最常用的曲线模式。为了增加曲线编辑的灵活性，每个顶点的切线方向，往往是可以自己手动编辑的。而且，大部分情况下，编辑器会为每个顶点提供这样三种曲线平滑的模式，供用户选择：

1.  两侧切线方向相同，且长度相等；
2.  两侧切线方向相同，长度可以不相等；
3.  两侧切线方向和长度都可以不相等。

## 三次样条 / Cubic Spline 曲线

### 三次样条曲线的推导

在出现计算机辅助设计之前，人们会使用样条来辅助设计曲线。样条是具有一定弹性的软木条，压铁是用来固定样条经过点的较重的铁块。

![[a323816e4a1048bfe786abdce9473555_MD5.png]]

从物理角度可以推导出，在样条弯曲角度较小时，样条曲线中每一段都可以用三次多项式函数来近似表示。

相对于前面我们讲到的分段三次多项式插值，三次样条曲线，可以保证曲线是二阶连续的，因此光滑性会更好。

接下来我们来看下如何使用三次多项式来对每段的方程进行求解：

设有 n+1 个点 $[(x_0, y_0), (x_1, y_1,) \dots (x_n, y_n)]$ ，构成了 n 个区间，每个区间的曲线都用一个三次多项式来表示 $y_i = a_i + b_i x + c_i x^2 + d_i x^3$ ，我们把每段的这个函数记为 $S_i(x), i\in[0, n-1]$ 。

因为有 n 个区间，每个区间是一个三次多项式，有 4 个未知数需要求解，这样一共是 4n 个需要求解的未知数。这就意味着我们需要 4n 个限定条件。我们已知的条件有：

*   每段曲线两端经过两端的点，即 $S_i(x_i) = y_i, S(x_{i+1}) = y_{i+1}$ ，构成 2n 个条件；
*   相邻的两段曲线，满足 $C^1$ 连续和 $C^2$ 连续，即 $S_i'(x_i) = S_{i+1}'(x_i) , S_i''(x_i) = S_{i+1}''(x_i)$ ，构成 2n-2 个条件；

这样，我们共有 4n-2 个条件，还差两个。我们来为两端的端点，来设置一些限制条件。

1、指定两个端点的一阶导数值，即 $S'(x_0) = f'_0, S'(x_n) = f'_n$ ；

2、指定两个端点的二阶导数值，即 $S''(x_0) = f''_0, S''(x_n) = f''_n$ 。

特别，当指定 $S''(x_0) = S''(x_n) = 0$ 时，模拟样条两端不受限制的情况，此时也叫做**自然边界条件**。

这样有了 4n 个条件以后，我们就可以来推导三次样条曲线的解：

令 $m_j = S'(x_j), M_j = S''(x_j), h_j = x_{j+1} - x_j$ ，已知 $S(x)$ 在 $[x_j, x_{j+1}]$ 上是三次多项式，因此 $S''(x)$ 在 $[x_j, x_{j+1}]$ 上是线性函数，因此可以将其表示为：

$$S''(x) = M_j \frac{x_{j+1} - x}{6h_j } + M_j \frac{x-x_j}{6h_j }$$

对 $S''(x)$ 进行两次积分运算，且利用 $S(x_j) = y_j,S(x_{j+1}) = y_{j+1}$ ，可以求得三次样条曲线的表达形式为：

$$S(x) = M_j \frac{(x_{j+1} - x)^3}{6h_j } + M_j \frac{(x - x_{j})^3}{6h_j } + (y_j - \frac{M_j h_j^2}{6}) \frac{x_{j+1} - x}{h_j } + (y_{j+1} - \frac{M_{j+1} h_j^2}{6}) \frac{x - x_j}{h_j } $$

$M_j$ 目前还是未知的，对 $S(x)$ 再进行求导可得：

$$S'(x) = -M_j \frac{(x_{j+1} - x)^2}{2h_j} + M_{j+1} \frac{(x-x_j)^2}{2h_j} + \frac{y_{j+1} - y_j}{h_j} - \frac{M_{j+1} - M_j}{6}$$

由此算出区间内左端点处的导数为：

$$S'(x_j+0) = - \frac{h_j}{3} M_j - \frac{h_j}{6} M_{j+1} + \frac{y_{j+1} - y_j}{h_j}$$

使用类似的方式，在 $[x_{j-1}, x_j]$ 区间内，求出右端点处的导数为：

$$S'(x_j-0) = \frac{h_{j-1}}{6} M_j + \frac{h_{j-1}}{3} M_{j+1} + \frac{y_{j} - y_{j-1}}{h_{j-1}}$$

已知两段曲线，连接处导数相等，可得：

$$\mu _j M_{j-1} + 2 M_{j} + \lambda_j M_{j+1} = d_j \tag{5}$$

其中 $\mu_j = \frac{h_{j-1}}{h_{j-1} + h_j}, \lambda _j = \frac{h_j}{h_{j-1} + h_j} ,\\ d_j = 6 \frac{f[x_j, x_{j+1}] - f[x_{j-1}, x_{j}]}{h_{j-1} + h_j} = 6f[x_{j-1}, x_j, x_{j+1}]$

在使用第一种限制条件时，整个曲线两段的一阶导数是已知的，可得：

$$\begin{cases} 2M_0 + M_1 = \frac{6}{h_0}(f[x_0, x_1] - f_0'))\\ M_{n-1} + 2M_n = \frac{6}{h_{n-1}} (f_n' - f[x_{n-1}, x_n]) \end{cases}$$

令 $\lambda_0 = 1,d_0 = \frac{6}{h_0}(f[x_0,x_1] - f_0'), \mu_n = 1, d_n = \frac{6}{h_{n-1}}(f_n' - f[x_{n-1}, x_n])$ ，我们可以将整个的方程，写成矩阵形式:

$$\begin{bmatrix} 2 && \lambda_0 \\ \mu_1 && 2 && \lambda_1\\ && \ddots && \ddots && \ddots\\ && && \mu_{n-1} && 2 && \lambda_{n-1}\\ && && && \mu_n 2 \end{bmatrix} \begin {bmatrix} M_0 \\ M_1 \\ \vdots \\ M_{n-1} \\ M_n \end{bmatrix} = \begin {bmatrix} d_0 \\ d_1 \\ \vdots \\ d_{n-1} \\ d_n \end{bmatrix} \tag{6}$$

对于第二种边界条件，我们可以得到： $M_0 = f_0'', M_n = f_n''$ 。

令 $\lambda_0 = \mu_n = 0, d_0 = 2f_0'', d_n = 2f_n''$ ，我们同样可以得到矩阵方程（6）。

这种线性返程组，是关于 $M_j$ 的三对角线性方程组，在力学中可以解释为细梁在 $x_i$ 处的弯矩，称为 $S(x)$ 的矩，得到的线性方程组称为三弯矩方程。系数矩阵中的参数值都是完全确定的，且满足 $\lambda_j \geq 0, \mu_j \geq 0, \lambda_j + \mu_j = 1$ ，因此系数矩阵是严格对角占优阵，方程组有唯一解，且可以使用追赶法来进行求解。

在 x 坐标值，不是严格递增时，我们同样可以使用参数化的方式，来对三次样条曲线进行参数化处理，这些和前面的参数化处理方式相同。

## 贝塞尔曲线

### Bezier 曲线的引入和性质

当我们使用幂基来表示一条参数化曲线的时候，我们可以将各个幂基的系数组合起来，形成对应的一个个点。

比如对于一条抛物线， $ f(x) =  a t^2 +  b t +  c$ ，每个幂基的系数，可以看做一个点，对于下面的抛物线，可以分解成这样三个点：

![[9e5d4bb1eceb17917da00558c1785f84_MD5.png]]

显然这种分解方式，得到的三个点，和函数图像之间没有直观的联系，不利于曲线设计建模。

为了使点到曲线的关系更加直接明显，我们使用 **Bernstein basis/ 伯因斯坦基**来作为多项式表示的基，将前面的多项式进行改写：

![[63d90d1c6c49fd1126da37d3278c98cc_MD5.jpg]]

可以看出，此时从点到曲线的关系非常直接明显，有很好的几何意义。

n 次 Bernstein 基函数的表示形式为：

$B_i ^{(n)} (t) = \begin {pmatrix} n\\i \end {pmatrix} t^i (1-t)^{n-i}\\ \begin {pmatrix} n\\i \end {pmatrix} = \frac{n!}{(n-i)!i!}$

贝塞尔曲线的表示公式为：

$$ p(t) = \sum_{i = 0}^{n}{ B_i ^{(n)}(t)}  p_i \tag{7}$$

前三次的 Bernstein 基函数的图像如下：

![[7e244a48509234e0c5495c644c6c69c8_MD5.png]]

贝塞尔曲线有非常好的几何性质，n 阶的贝塞尔曲线，有 n+1 个**控制点**，改变控制点的位置，可以非常方便地控制曲线的形状：

![[127154a713852511047cfdbb66309f6f_MD5.jpg]]

Bezier 曲线有这样一些性质：

（1）正权性。正性表示所有基都是非负的。权性表示，所有基的和是 1。

（2）凸包性。由正权性可推出，整个曲线，落在所有控制点形成的凸包内。

（3）基性。n 次 Bezier 曲线的基函数，都是次数不高于 n 的多项式，且和幂基可以互相线性表示：

（4）递推性，高次的基函数，可以从低次的基函数递推得到： $B_i ^{(n)} (t) = (1-t) B_i^{n-1}(t) + t B_{i-1}^{n-1}(1-t)$ 。

（5）贝塞尔曲线，过两端的控制点。 $f(0) =  p_0, f(1) =  p_n$

（6）端点处切线，和端点边方向相同。 $f'(0) = ( p_1 -  p_0), f'(1) = ( p_{n} -  p_{n-1})$

Bezier 曲线有很多非常良好的性质，在游戏和图形学中有非常广泛的应用。

### 几何角度的贝塞尔曲线生成

在从控制点来计算 Bezier 曲线时，可以使用递推的方式来计算出曲线。

在已知参数 $t$ 时，可以将最终插值点的位置，通过逐层递推的方式计算出来，这也是我们常见的一种计算贝塞尔曲线的方式：

![[f5e2c6e0921865cdfd2be9e8ac9e02a8_MD5.jpg]]

### 分段贝塞尔曲线

和前面讲到的多项式曲线一样，如果控制点比较多，贝塞尔曲线次数很高时，计算起来会比较复杂，且每个点都会对整条曲线造成影响。因此在有的时候，我们会使用分段的贝塞尔曲线。

由贝塞尔曲线的性质可知，曲线端点处的切线方向和端点边方向相同，两段贝塞尔曲线在拼接处连续，只要连接处两边的控制点，方向相同且距离相等即可。

![[62e15b744169c3bed90196461e4e4431_MD5.png]]

这样，我们便可以通过这样的方式来生成分段的贝塞尔曲线：

对于一系列的点，将某个点两侧的点连接，形成一个向量，然后按照一定长度比例，在当前点两边一定距离取新的点，构成控制点。然后每两个点之间，构成一段贝塞尔曲线，就构成了简单的 C1 连续的分段贝塞尔曲线。

### 有理贝塞尔曲线

在使用贝塞尔曲线时，我们会发现贝塞尔曲线有的时候，表示能力和曲线控制的灵活度有的时候不够。比如我们现在想用贝塞尔曲线来表示一个圆弧，就无法通过普通的贝塞尔曲线来直接表示出来。

因此我们给每个控制点，增加一个属性叫做权系数 $w_i$ ，这样就形成了**有理贝塞尔曲线 / Rational Bezier Curve**，计算公式为：

$$ p(t) = \frac{ \sum_{i = 0}^{n}{w_i  B_i ^{(n)}(t)}  p_i}{ \sum_{i = 0}^{n}{w_i  B_i ^{(n)}(t)} } \tag{7}$$

有理贝塞尔曲线具有大部分贝塞尔曲线的性质，也是具有良好的曲线特征。

当某个点的权系数越大，曲线就会越靠近这个点。

![[6d53eb5ddc190dc817ec513dfdbf7047_MD5.png]]

我们使用有理贝塞尔曲线来表示 1/4 圆：

![[ab898612c733a16cd170c22e6fc25c02_MD5.png]]

## B 样条 / B-Splines 曲线

### B 样条曲线的引入

我们知道，对于 N+1 个控制点的 N 阶贝塞尔曲线，是 N-1 阶连续的。当控制点数量很多时，贝塞尔曲线的阶数会比较高，曲线会同时受所有控制点的影响，计算起来也会比较复杂。尽管曲线的连续性得到了保障，但是在实践中我们往往并不需要这么高的连续性。

因此，我们希望有一种类似于分段曲线的曲线方案，可以来自由指定每个点的连续性阶数，或者自由指定曲线中任意段，受多少个点的影响。换句说，相对于贝塞尔曲线使用的全局的基函数，我们希望使用局部的基函数，来表达整条曲线。

为了保证曲线的良好性质，基函数的权性和正交性仍然是要满足的，类似于贝塞尔曲线的基函数。N 阶贝塞尔曲线使用 N 阶的 Bernstein 基也是 N 阶的。

比如对于 2 次 B 样条曲线函数，我们期望每个控制点，在不同段曲线上的权重如下图所示：

![[3bba84df1e89921984893059ff5ff022_MD5.png]]

将 k 阶 B 样条曲线的基函数表示为 $N_i ^ k$ ，我们这里通过递推的方式，来得到 $N_i^k$ 的表达式。

当 $k = 1$ 时，每个控制点只会影响周围一段曲线，也就是简单的线性插值。当 k 不为 1 时，我们使用递推的方式，对上一阶中的基函数进行线性插值，来得到其基函数：

![[f3153dc5f4f7bbc8347219f89db3b45c_MD5.png]]

得到 B 样条曲线：

$$f(t) = \sum_{i =1}^{n}{N_i^{(d)}(t) p_i} \\ \tag{8}$$

这样，我们就可以来计算 B 样条曲线了，不过为了保证曲线的权性，N+1 个控制点并不能刚好构成 N 段的曲线。

当 B 样条曲线次数为 1 时，形成简单线性插值，每段曲线收到 2 个控制点的影响，N+1 个控制点可以形成 N 段曲线。当 B 样条曲线次数为 k 时，每段曲线受到 k+1 个控制点的影响，N+1 个控制点，能构成 N+2-k 段曲线，曲线是 k-1 阶连续的。

![[8f7b9f14242fd9cbac6097c1e8e7d3cb_MD5.png]]

这样当 k>1 时，我们得到的曲线其实是没有过两段端点的。

### 添加 Knot Point

要想让 B 样条曲线，能像贝塞尔曲线那样过两端的控制点。我们可以通过添加 **knot point / 型值点**的方式来实现这个目标。

前面我们所讲的 B 样条曲线，每个点的参数是必须满足严格递增的，也就是 $t_0 < t_1 < \dots < t_n$ ，在 knot point 模式下，我们允许两个相邻控制点的参数相同，即 $t_0 \leq t_1 \leq \dots t_n$ 。

这样，对于 k 阶的 B 样条曲线，我们可以在两端分别添加 k-1 个重复的 knot point，即：

$t_0 = t_1 = \dots = t_{n-1}\\ t_{n+1} = t_{n+2} = \dots = t_{n+k}$

![[f20d9c71618133676f2a849bd12dfe3e_MD5.jpg]]

当 k = n-1 时，通过这种方式，此时正好形成了 k 阶的贝塞尔曲线。所以说 B 样条曲线，是贝塞尔曲线的一个超集。

当 k < n-1 时，我们通过这种方式，构成了满足 k-1 阶连续的具有局部性的 B 样条曲线。

除了在两端添加 knot point，我们还可以在曲线中间添加重复点，这样可以来手动控制曲线的连续性。比如我们想让 B 样条曲线在某个控制点处形成拐点，不产生连续性，就可以在此处添加多个 knot point。比如我们想让某段曲线是直线，就可以在这段曲线两段的点，添加几个 knot point。这样就实现了对曲线的灵活控制。

![[2d902132069e684fc210b7b6450218d3_MD5.png]]

### NURBS 曲线 / Non-Uniform Rational B-Spine Curves

NURBS 曲线是对 B 样条曲线的升级。类似于有理贝塞尔曲线，NURBS 曲线可以为每个控制点添加一个权系数 $\omega _i$ 。

这样 NURBS 曲线的表示为：

$$f(t) = \frac{ \sum_{i =1}^{n}{N_i^{(d)}(t)\omega_i p_i}}{ \sum_{i =1}^{n}{N_i^{(d)}(t)\omega_i }} \\ \tag{9}$$

我们可以通过这样几个相关的设置来控制 NURBS 曲线：

*   控制点位置
*   曲线次数
*   knot point
*   权系数（得到圆锥曲线或者控制形状）

可以看出，NURBS 非常灵活，且表达能力非常强。

目前，NURBS 曲线已经成为工业标准，是各类 CAD 软件中的标准曲线格式。

![[aa74fcccadcfd8f0db2d095bfafa0fe2_MD5.jpg]]