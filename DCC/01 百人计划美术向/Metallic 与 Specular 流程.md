# 什么是次世代模型？  

“上个世纪留下来的黑话”。次世代源自日本语，即下一个时代，未来的时代。常说的次世代科技，即指还未广泛应用的先进技术。次时代游戏模型设计是指次世代游戏模型设计师根据原画稿件设计出次时代游戏中的环境、道具、机械、人物、动物、怪物等物体的模型。次世代模型的制作需要把高模的细节通过法线贴图贴到低模上，来让低模模拟高模的细节，所以次世代模型，分为高模和低模。目前对次世代一词运用最多的领域是家用游戏机，但随着技术的进步，在网游界也逐渐兴起了次世代技术的运用。  

# 什么又是PBR模型？  

基于物理的渲染模型，是当前主流游戏引擎使用的真实感3D渲染模型，在游戏场景渲染中，它用更接近物理光学的方式，建立一个对全场景材质的大一统shader。这里推荐[一个网站](https://sketchfab.com/store?ref=header)可以观测3D模型的很多PBR流程中的一些常见贴图信息。  

我们制作出来的法线贴图等通过UV对应到物体模型的每一个位置上，描述每个位置的属性（比如某个位置的法线是什么方向的，它的粗糙度是多少，它是不是金属），并把这些参数都传输到着色器中。这些信息都会作为变量输入到PBR方程中， 最终得到颜色输出就是我们所看到的比较接近物理真实的样子了。  

![[1678970899765.png]]  

# 两种流程  

常用的工作流程：金属(Metal)/粗糙度(Roughness)工作流 和 镜面反射(Specular)/光泽度(Glossiness)工作流。  

我们首先面临的就是选择哪种工作流程？答案是哪种都可以。金属的工作流程比较符合直觉，应用广泛，不过没办法很好调节零度菲涅尔反射值。镜面反射可以很好地调节这个值，但是错误的贴图会打破能量守恒，渲染结果就会和你想要的结果有些出入。  

![[1678970899799.png]]  

这两种流程有三个通用的贴图：  

*   法线贴图  
    

*   AO贴图  
    

*   高度贴图  
    

# 一、金属/粗糙度工作流  

## ①base color 贴图 RGB贴图 （被标志为sRGB）  

储存数据：非导体（电介质）的漫反射色/反照率颜色（Diffuse Reflected Color/Albedo）和金属导体的镜面反射的F0值。  

非导体使用4%*（0.04）的F0反射值。  

混合材质（即非导体和金属导体混合材质）则可以认为同时储存了这两种数据。  

![[1678970899835.png]]  

原则上来讲，base color存储的信息不应该带有光影信息。因为PBR的光影信息是通过方程式算出来的，所以我们存储的颜色范围应该有一定的约束。因为现实中几乎无法见到纯白或纯黑（比如1.0和0.0），所以我们最好不要采取这些极端数值。  

非导体（即电解质，非金属）：暗色值，尽量不要低于30-50sRGB，严格控制下应不低于50sRGB。对于亮色值，贴图中不应高于240 sRGB。  

导体（金属）的反射值：金属一般会有70-100%的镜面反射，映射到sRGB大概为180-255，如下图所示。不能把漆面当程金属来看。  

在Substance Designer软件中，你可以通过PBR BaseColor/Metallic Validate节点来验证是否在合适的范围内。  

![[1678970899924.png]]  

传统工作流会带有一些光影信息，而PBR工作流中的Diffuse不带有光影信息。  

![[1678970899958.png]]  

凡事不讲太绝对，有一种光影信息是可以存储在PBR工作流的Diffuse当中——就是那些过于微小，在AO图中存储不合适的信息，我们一般称之为micro-occlusion，可以叠加在Base Color中增加细节，或者把它另外存储在capity Map 中（？），但与AO贴图不同的是它不仅会影响到漫反射，也会影响到高光反射。  

### 回顾一下 Base Color的几个要点  

1.贴图中的颜色对于非金属材质来说是它的漫反射颜色，对于金属材质来说则是它的镜面反射的F0值（Reflectance value，所带色相与其反射的波长有关）。  

2.Base Color除了微观遮蔽信息（Micro-occlusion）以外，不应该含有任何光照信息。  

3.暗色值在宽松条件下不应该低于30sRGB，严格来说不应该低于50sRGB。  

4.亮色值不应该高于240sRGB。  

5.原始金属的反射值一般都非常高，大概能达到70-100%的镜面反射，映射到sRGB范围大概是180-255。  

## ②Metallic 金属度贴图，灰度值->Linear  

储存数据：对应区域的金属度。  

作用类似于图层遮罩，告诉着色器应该如何去解读Base Color贴图中的RGB数据。  

0.0纯黑代表非金属，1.0纯白代表纯金属。  

当趋近于1时，就会转换为base color中的漫反射颜色，同时F0的值就会固定为4%；  

当趋近于0时，base color中的颜色就会代表着反射值F0；  

当数值位于0和1之间时，就代表这两种状态的混合——比如生锈的金属，锈迹部分可以适当压暗，来表示锈迹的反射颜色，压暗没有数据标准，但记住不要超过之前规定过的合理范围。  

![[1678970900002.png]]  

### 回顾一下Metallic贴图的几个要点  

1.金属被氧化、腐蚀、上漆、覆尘后，这些区域需要被当做非导体（电介质）材质来看待。  

2.在Metallic贴图中，纯黑（0.0）代表了非金属，纯白（1.0）代表了金属，我们可以用过渡的灰阶来表示不同程度氧化和污垢。  

3.如果Metallic贴图中有值低于235 sRGB，那么在Base Color中对应区域的反射值也应该降低。  

## ③Roughness 粗糙度贴图， 灰度贴图-Linear  

在粗糙度贴图中，纯黑（0.0）代表了平滑表面，而纯白（1.0）代表了粗糙表面。  

![[1678970900057.png]]  

粗糙度贴图用于描述造成一个表面不规则度，这种不规则度会造成光的漫反射，光会对随机方向进行反射，在这个现象中光的方向会被改变，但光的总强度却是恒定的。越粗糙的表面拥有越大越暗的高光，反之则拥有越小越亮的高光。粗糙度贴图可以说是一个具有创造力的贴图，因为它允许艺术工作者从视觉上定义一个表面的特性。  

# 二、镜面反射/光泽度工作流  

## ①Diffuse贴图 RGB贴图-sRGB  

存储数据：漫反射颜色（Albedo）  

![[1678970900112.png]]  

由于金属把反射光线都给吸收，它漫反射就会消失，所以纯金属的漫反射为纯黑。和金属度贴图类似，处于金属和非金属非导体中间的区域，可以改变Diffuse贴图中的颜色，让该区域的漫反射加上一些色彩。  

### 回顾一下Diffuse贴图中的要点  

1.Diffuse贴图中的颜色表示的是漫反射颜色，原始金属由于没有漫反射，颜色应该为纯黑（0.0）。  

2.Diffuse贴图除了微观遮蔽（Micro-occlusion）外不应该带有其他光照信息。  

3.除了表示金属的纯黑（0.0）外，暗色值最多不应该低于30sRGB，严格上说，不应该低于50 sRGB。  

4.亮色值不应该亮过240 sRGB。  

## ②Specular贴图 RGB贴图-sRGB  

储存数据：F0（0度菲涅尔反射值）  

F0值都是基于真实世界测量的，没有需要，尽量不要使用反常规的数值。严谨一些的话，你甚至可以查表。别忘了线性空间和sRGB的转换（伽马矫正）。  

![[1678970900407.png]]  

![[1678970900461.png]]  

和金属度/粗糙度工作流不同的是，到目前为止已经出现两个sRGB贴图了（金属度是一个）。另外，可以通过Specular贴图改变所有材质的F0值，但是注意不要使用错误的F0值，比如一个纯白的漫反射，和一个纯白的镜面反射的F0值，加起来算的话，它表示的反射光线就比它原来接受的光线还要多，就打破了我们说的能量守恒。  

### 回顾一下Specular贴图的几个要点  

1.镜面反射贴图包含F0值。  

2.普遍非导体的反射值为2-5%，在sRGB中，这个值大概在40-75之间。  

3.普通宝石的反射值范围在0.05-0.17（线性空间）。  

4.普通液体的反射值范围在0.02-0.04（线性空间）。  

5.而原始金属的反射值则可以高达70-100%的镜面反射，sRGB约为180-255%  

6.如果你无法找到某个材质的折射率（IOR），可以先假设F0为4%，也就是塑料的F0。  

③Glossiness 光泽度贴图，灰度贴图-Linear  

![[1678970900514.png]] 光泽度贴图适用于描述表面不平整度的贴图，表面不平整会造成光的散射。在这个贴图中，纯黑（0.0）代表的是粗糙表面，而纯白（1.0）代表了平滑表面。这和M/R工作流里的粗糙度贴图是完全相反的，但是在设计侧却有着类似的制图原则。  

Ok，我们终于结束了两种流程贴图存储数据的介绍和一些规范。  

最后说一下它们共同的一个问题，当贴图分辨率与纹素密度过小时，在金属导体和非导体交界会产生白边/黑边。所以要有一张良好大小和布局的UV。  

![[1678970900569.png]]  

最后再总结一下：  

![[1678970900626.png]]  

下面我们说说这两种流程的转换，本质上来说，贴图储存的是数据，两种流程储存的数据是部分一致的，我们要做的就是改变这些数据的位置和储存方式。这里我们参考八猴的教程和SD中的转换节点进行讲解。  

如果你安装了substance designer，可以查看它内部节点的实现方法（右键，open reference）。这里为了讲解我们选用PS完成，将下图的贴图数据进行转换。  

![[1678970900674.png]]  

# 小作业  

将今天讲的贴图注意点总结至之前的模型规范中，并测试两个流程的贴图转换。  

在我们开始之前，我们来澄清一些事情。在PBR方面存在很多混淆，首先，使用金属度贴图并不是 PBR 系统的唯一要求，使用高光贴图并不意味着Assets“不是 PBR”。我经常在论坛上看到关于这个的评论，当有人看到一个艺术家创建一个高光和光泽贴图时，他们经常问“你为什么不使用 PBR？”，所以让我们分解一下 PBR 到底是什么。  

最基本意义上的 PBR 是代表光和物质物理的复杂着色器的组合，以及使用合理值校准以代表真实世界材料的艺术内容。PBR 本质上是一个内容创建和渲染的整体系统，根据我们使用的工具或引擎，它在实际实现中可能并且经常存在差异（通常是着色器模型或纹理输入类型）。  

我们首先制作一个PBR枪模![[1678970900711.png]]  

基本shader参数如下：  

![[1678970900760.png]]  

## ①Metallic 流程->Specular流程  

纹理转换：金属度 -> 镜面反射  

从金属度工作流转换为镜面反射工作流很容易。我们只需要将漫反射和镜面反射信息从反照率贴图拆分为明确的漫反射和镜面反射纹理。  

在PS中新建Meta to Spec工程文件  

![[1678970900796.png]]  

*   Diffuse部分：  
    

方法：去掉base color中的金属和混合材质的F0数据  

流程：  

*   打开base color和metallic，RGB模式；  
    

*   新建Diffuse图层，纯黑填充（#000000）；  
    

*   单独显示metallic，在通道里Ctrl+左键点选任意通道，选中选区；  
    

*   Diffuse图层添加蒙版，自动将选区粘贴进蒙版；  
    

*   不需要改变图层类型。  
    

那么，核心操作如下：  

新建#000000纯黑Diffuse图层，单独显示metallic  

  

ctrl+左键选中红色通道（任意），选中选区  

Diffuse图层添加蒙版，自动将选区粘贴进蒙版  

  

隐藏金属，并导出命名为Diffuse贴图  

  

*   base color + metallic -> Specular  
    

  

方法：去掉base color 中的漫反射数据，并加上非导体和混合材质的F0(默认0.04)】  

流程：  

*   打开base color 和 metallic，RGB模式；  
    

*   新建Specular图层，填充#383838；（0.04的linear对应约22的灰度，对应约56的RGB，对应代码#383838）  
    

*   （如果有specular level忒图，转换成对应的RGB颜色）  
    

*   选中metallic，ctrl+i反相。单独显示，在通道里ctrl+左键点选任意通道，选中选区；  
    

*   Specular图层添加蒙版，自动将选区粘贴进蒙版。  
    

那么，核心操作如下：  

新建Specular图层  

  

ctrl+i反相金属度。  

![[1678970901085.png]]  

利用金属度红色通道选中选区，再打开Specular图层创建蒙版，并隐藏金属度，并导出Specular贴图  

![[1678970901121.png]]  

*   Roughness->Glossiness  
    

方法：直接将Roughness贴图反相即可  

![[1678970901157.png]]  

### 输出部分  

我们在Metallic 流程->Specular流程后得到了这三张贴图  

![[1678970901195.png]]  

## ②Specular流程->Metallic流程  

![[1678970901495.png]]  

*   Diffuse + Specular -> Base color + Metallic  
    

方法：  

找出金属区域对应的数据，金属的特性是FO在0.7-1之间，而非金属一般都不超过0.04，宝石最高可达0.17，差异明显。第二，金属没有漫反射，Diffuse中为黑色。所以我们可以从Specular或者Diffuse贴图中生成Metallic贴图。你可能需要多次尝试才能得到与转换前较为一致的效果。  

流程：  

Specular，菜单选择，色彩范围，选择阴影，灰度预览，调整参数。（也可以使用Diffuse图层）（效果不好的话可以将阴影换为取样颜色，选择纯黑，调整容差）shift+ctrl+i反选，创建蒙版。  

alt+左键拖动蒙版到Diffuse图层，选择蒙版，ctrl+i反相。  

Base color完成。  

新建Metallic图层，填充黑色，ctrl+左键点击Specular蒙版进行选区，填充白色。  

Metallic 完成。  

那么，核心操作如下：  

Specular-选择-色彩范围-阴影-选区灰度  

![[1678970901532.png]]  

shift+ctrl+i反选，并创建蒙版  

![[1678970901580.png]]  

把Diffuse贴图移动到Specular的上面易岑一层，并alt+左键拖动蒙版到Diffuse层上  

![[1678970901625.png]]  

将此时的图层导出，命名为BaseColor贴图  

*   Metallic制作如下  
    

![[1678970901663.png]]  

0代表非金属，1代表金属，正确。  

*   Glossiness->Roughness  
    

方法：反相  

实操：ctrl+i，反相即可  

![[1678970901700.png]]  

导出Roughness贴图  

### 输出部分  

我们在Specular流程->Metallic流程后得到了这三张贴图  

![[1678970901995.png]]  

## ③八猴4渲染  

打开八猴4，导入同样的2个模型，并创建Meta2Spec和Spec2Meta材质  

![[1678970902121.png]]  

根据流程一个个把贴图贴上  

Meta2Spec  

![[1678970902161.png]]  

Spec2Meta  

![[1678970902203.png]]  

## ④效果观察  

两者近距离观察，其实都差不多  

### 整体视角  

Specular流程  

![[1678970902488.png]]  

Metallic流程  

![[1678970902546.png]]  

### 枪头视角  

Specular流程：  

![[1678970902820.png]]  

Metallic流程：  

![[1678970902858.png]]  

### 枪身视角  

Specular流程：  

![[1678970902899.png]]  

Metallic流程：  

![[1678970903195.png]]  

### 扳机+枪托视角  

Specular流程：  

![[1678970903238.png]]  

Metallic流程  

![[1678970903449.png]]  

需要注意的重要一点是，因为基础内容我们在PBR制作流程中被校准到合理的值，所以转换过程运行良好。如果基本内容未校准，你会看到转换中的更大差异。类似地，某些材料例如具有彩色反射的绝缘体（通常非常罕见，通常最好用自定义着色器来表示典型材料，例如头发或彩虹色材料），通常可能会在转换过程中丢失一些信息。  

# 参考链接  

次世代模型是什么意思?次世代模型有什么要求? [https://zhuanlan.zhihu.com/p/145564545](https://zhuanlan.zhihu.com/p/145564545)