# 线性代数
## 正定/半正定矩阵
positive definite 正定
positive semi-definite 半正定

给定一个大小为  $n \times n$ 的实对称矩阵 $A$，若对于任意长度为 $n$ 的非零向量 $x$，有 $x ^TAx>0$ 恒成立，则矩阵 ![A](https://www.zhihu.com/equation?tex=A&consumer=ZHI_MENG) 是一个正定矩阵。
正定矩阵所有特征值$> 0$

给定一个大小为  $n \times n$ 的实对称矩阵 $A$，若对于任意长度为 $n$ 的非零向量 $x$，有 $x ^TAx>=0$ 恒成立，则矩阵 ![A](https://www.zhihu.com/equation?tex=A&consumer=ZHI_MENG) 是一个正定矩阵。
正定矩阵所有特征值$>= 0$
# 概率论
## 概率分布函数 CDF
![[概率论与数理统计#3 随机变量的概率分布函数 CDF]]
## 概率密度函数 PDF
![[概率论与数理统计#(1) 连续型随机变量的概率密度函数 PDF]]
## 数学期望 E (X)
![[概率论与数理统计#1 数学期望 E(X)]]
## 协方差 Cov 
![[概率论与数理统计#5 协方差与相关系数#定义]]


## 协方差矩阵


![[Pasted image 20230624134004.png]]

其中，对角线上的元素为各个随机变量的**方差**，非对角线上的元素为两两随机变量之间的**协方差**，协方差矩阵是一个对称矩阵

**协方差矩阵是半正定的**


# 3D Gaussian

## 1D 高斯
[[概率论与数理统计#正态分布 （高斯分布/误差分布）]]、


> [!NOTE] 重要参数
> $X\sim N(\mu,\sigma^2)$
> 均值 $\mu$ 和标准差 $\sigma$：分布的最高点是均值 $\mu$ 的位置，宽度则由标准差 $\sigma$ 指定。

若 $X$ 的**概率密度函数**为
$$
f(x)=\frac{1}{\sqrt{2\pi}\sigma}e^{-\frac{(x-\mu)^{2}}{2\sigma^{2}}},-\infty<x<+\infty,
$$
其中 $-\infty<\mu<\infty,\sigma>0$，就称 $X$ 服从参数为 $\mu,\sigma$ 的**正态分布（或高斯分布）**，记为 $X\sim N(\mu,\sigma^2)$

概率密度函数图像如下：
![[Pasted image 20230623235745.png]]
>改变均值会产生沿 $x$ 轴的偏移，增加方差将会分散分布、降低其峰值。


![[Pasted image 20231112115439.png]]
>通过正态分布，可以判断有多少比例的数据在平均值（μ）的 1 个标准差（σ）内，2 个标准差内...
>如图：
> - 68％的数据在平均值（μ）的 1 个标准差（σ）内
> - 95％的数据在平均值（μ）的 2 个标准差（σ）内
> - 99.7％的数据在平均值（μ）的 3 个标准差（σ）内


## 3D 高斯
一组 $\mu$, $\sigma$ 可以确定一个 1D 高斯分布函数，进而确定一条1D 线段 $[\mu-3\sigma,\mu+3\sigma]$，通过改变 $\mu-\sigma$，可以表达1D 数轴上的一根线段。
类似的，拓展为三维高斯分布，确定的图形是一个**椭球**，这个椭球分别以 xyz 轴对称，从对称轴的垂直面切出来的横截面都是椭圆（或圆）。不过由于这个椭球可以旋转移动，所以它的 xyz 对称轴（后文称为**模型坐标系**）不一定和世界坐标系重叠。

就像给3个顶点能表达**任意**一个3D 三角形，研究者自然希望构筑的基础元素能覆盖足够多样的几何，**这里先给出3D Gaussians 标准形式**，它能涵盖空间中任意形状的椭球（包括平移旋转）：

$$
G_s\left(x\right)=\left(\frac{1}{\sqrt{2\pi}^{3}\det\left(\Sigma\right)}\right)e^{-\frac{1}{2}\left(x-\mu\right)^{T}\Sigma^{-1}\left(x-\mu\right)}
$$
可以看到一些高斯分布共通的结构，比如**规范化系数**（将密度积分规范化为1）乘上**指数项**的形式，其中 $x=\left[a,b,c\right]^T$ 是三维列向量坐标， $\mu$ 是椭球中心（控制世界空间位置平移），协方差 $\Sigma=\begin{bmatrix}\sigma_a^2&\operatorname{Cov}\left(a,b\right)&\operatorname{Cov}\left(a,c\right)\\\operatorname{Cov}\left(b,a\right)&\sigma_b^2&\operatorname{Cov}\left(b,c\right)\\\operatorname{Cov}\left(c,a\right)&\operatorname{Cov}\left(c,b\right)&\sigma_c^2\end{bmatrix}$ 控制椭球在3轴向的伸缩和旋转（模型空间），其中协方差矩阵的特征向量就是椭球对称轴。（注意，协方差矩阵是一个平方项，里面比较对称，后面可以看到在构造时也是平方形式）

---

**论文则这样定义：**
$$
G(x)~=e^{-\frac{1}{2}(x)^{T}\Sigma^{-1}(x)}
$$
和标准形式对比可以看到去掉了指数部分前面的尺度系数（不影响椭球几何）；默认模型坐标中心在原点（令 $\mu=0$），方便旋转放缩，放入世界空间时再加上平移。

---

梯度下降法优化协方差矩阵 $\Sigma$ 时可能会产生非半正定矩阵，而协方差矩阵只有在半正定时才有意义。

既然数值角度不好办，不如直接上手几何，**原文提到3D 高斯和椭球是同构的**，而椭球是可以通过将球**按轴向缩放再旋转**（注意顺序，先缩放再旋转，椭球的对称轴一直是模型空间的 xyz 轴，互相垂直）得到的，于是论文给出了初始化方法是使用缩放变换 $S$ 和旋转变换 $R$ 组合得到 Σ ：

$$\Sigma=RSS^\top R^\top$$

由于缩放变换都是沿着坐标轴，所以只需要一个3D 向量 $s$ ，旋转则用四元数 $q$ 表达。机器学习通常使用梯度下降对参数进行优化，但直接优化 Σ 难以保证半正定，所以论文的方法是继续将梯度传递到 $s$, $q$ 进行优化。

# 球谐函数
## 定义
球谐函数（Spherical Harmonics/SH）由几组正交基函数线性组合构成，可以表示球面不同位置的属性。

**基函数定义：**
$$
Y_{l}^{m}(\theta,\phi)=\left\{\begin{array}{rr}\sqrt{2}K_{l}^{m}\cos(m\phi)P_{l}^{m}(\cos\theta)&\quad(m>0)\\\sqrt{2}K_{l}^{m}\sin(-m\phi)P_{l}^{-m}(cos\theta)&\quad(m<0)\\K_{l}^{0}P_{l}^{0}(cos\theta)&\quad(m=0)\end{array}\right.
$$

-  $l$ 表示 **band** 值（也可以称为阶数）
-  $m$ 表示当前**band**下第几个基函数（ $−l≤m≤l$ ）。
- $(\theta,\phi)$：俯仰角、偏航角
-  $K,P$ 的表达式相当复杂，我们不需要详细了解其推导过程，在使用中能够查表得到其函数即可：[球谐波表 - 维基百科，自由的百科全书 (wikipedia.org)](https://en.wikipedia.org/wiki/Table_of_spherical_harmonics)
- 与 $r$ 无关

**特性：**
- 正交性：SH 的每个 band 下都是一组正交基函数，同阶的不同基函数，两两内积为 0。
- 旋转不变性：旋转球谐函数等价于同阶其他基函数的线性组合

![[Pasted image 20230714160043.png]]
>  $l$ ：阶数，通常第 $l$ 阶有 $2l+1$ 个基函数，前 $n$ 阶有 $n^2$ 个基函数。
> $m$ ：该阶数下基函数的序号，分别从从 $-l$ 一直到 $l$。

简单点来说，每一个球谐函数都可以由多个基函数**线性组合**构成，如果我们有很多基函数，我们可以通过对应的 **SH 系数**拟合出原来的函数，不过本质上还是一个有损压缩，不一定那么准确。**阶数越高，基函数越多，拟合结果越准确**，但是计算量也变大了。（类似傅里叶级数拟合函数的过程）
![[Pasted image 20240403204932.png]]

**具体来说，我们想通过球谐函数拟合原函数。我们先选定一个球谐函数的阶数 $l$，然后分别求 $0\to l$ 阶所有基函数的 SH 系数（投影），最后将基函数线性组合（重建）。准确性由阶数 $l$ 决定**

## 投影（求SH系数）
**求任一基函数的系数称为投影**

给定一个球面原函数 $f(\theta,\phi)$，对于任何一个基函数 $Y_{l}^{m}(\theta,\phi)$，他的系数 $c_i$ 通过以下公式求投影：
$$
c_i=\int_{\Omega}f(\theta,\phi)Y_{l}^{m}(\theta,\phi)\mathrm{~d}(\theta,\phi) 
$$
## 重建（拟合）
**知道基函数对应的系数，就能通过系数和基函数的线性组合来拟合原函数**

由于基函数的阶可以是无限个的，越高的阶可恢复的细节就越好, 但一方面是因为更多的系数会带来更大的存储压力、计算压力，图形学中一般描述变化比较平滑的环境漫反射部分，用 3 阶 SH 的低频信息就足够了。

## 应用

下面展示的是一个 3 阶的球谐函数，一共包括 9 个系数，拓展到 rgb，就是3 * 9 = 27个系数。我们可以根据 $\theta,\phi$ 得到球面对应位置上的颜色，可以看到最后是 red 红色分量。
![[Pasted image 20240403205009.png]]

# 数学推导 TODO
[3D Gaussian Splatting中的数学推导 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/666465701)



