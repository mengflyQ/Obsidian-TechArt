---
number headings: auto, first-level 1, max 6, 1.1
---


# 1 docker 的容器化
## 1.1 容器化的好处
软件开发的一大阻碍就是运行环境，在容器概念提出以前，用户可以通过虚拟机还原软件的原始环境实现虚拟化，但是虚拟机方法存在资源占用多、无法跳过系统操作步骤、启动慢等问题。由于虚拟机存在这些缺点，Linux 发明了一项新技术：Linux Container（LXC）, LXC 通过对进程进行隔离而不是模拟完整的操作系统来实现容器化。容器化是操作系统虚拟化的一种形式，换句话说容器使用的是操作系统级别的虚拟化技术，而不是虚拟机级别的虚拟化技术。用户可在使用相同共享操作系统的隔离用户空间（称为容器）中运行应用程序。应用程序容器是一个完全打包、可移动的计算环境。
由于 LXC 是进程级别的，相比虚拟机有很多优势，首先是启动快，容器里面的应用，直接就是底层系统的一个进程，而不是虚拟机内部的进程。所以，启动容器相当于启动本机的一个进程，而不是启动一个操作系统，速度就快很多。其次是资源占用少，容器只占用需要的资源，不占用那些没有用到的资源；虚拟机由于是完整的操作系统，不可避免要占用所有资源。另外，多个容器可以共享资源，虚拟机都是独享资源。此外容器还有体积小的优点容器只要包含用到的组件即可，而虚拟机是整个操作系统的打包，所以容器文件比虚拟机文件要小很多。总之，容器就像轻量级的虚拟机，能够提供虚拟化的环境，但是成本开销小得多。
除了上述提到的优点，容器化补充了 DevOps，因为可以更快地部署和测试软件，从而改善反馈循环。容器化也是微服务流行的一个主要因素，微服务是一种提高灵活性和敏捷性的软件架构。你可以使用容器化来加快开发新功能和获得反馈所需的时间。平台即服务 (PaaS) 解决方案和容器编排工具（如 Kubernetes）让开发人员可以大规模操作容器。容器编排器可以根据需求和负载向上和向下扩展软件应用程序中的各个组件。这可以节省成本，因为组件仅在需要时运行。扩展还提高了可靠性，因为容器编排器可以将足够的资源分配给应用程序的高需求部分。
Docker 是 LXC 的一种封装，提供简单易用的容器使用接口。它是目前最流行的 Linux 容器解决方案。Docker 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样。有了 Docker，就不用担心环境问题。总体来说，Docker 的接口相当简单，用户可以方便地创建和使用容器，把自己的应用放入容器。容器还可以进行版本管理、复制、分享、修改，就像管理普通的代码一样。
![[Pasted image 20240419215436.png]]
>虚拟化和容器化架构对比（[什么是 Linux 容器（LXC）？一文带你快速了解容器技术 - 红帽 (redhat.com)](https://www.redhat.com/zh/topics/containers/whats-a-linux-container)）



## 1.2 可移植性（Portability）
容器是可移植的，因此它们可以在任何基础架构上的任何位置运行，例如在云中、VM 或裸机上。开放容器倡议 (OCI) 为容器设计开放标准，确保任何符合 OCI 的容器在任何基础设施上都以相同的方式运行。要运行应用程序，容器会加载容器 image。容器映像是一个静态文件，其中包含在 IT 基础架构上运行进程的可执行代码。有针对不同用例的容器映像，例如数据库、Web 服务器、操作系统等。容器镜像存储库是容器镜像的公共访问点，这使得它们可供开发人员使用，他们可以使用这些镜像加载容器。如果你想为你的应用程序使用容器，你可以确保你使用的任何 OCI 映像都可以在你的基础架构上运行，即使你的基础架构发生了变化。
Docker 的 image 文件称为 Docker image, Docker 把应用程序及其依赖，打包在 image 文件里面。只有通过这个文件，才能生成 Docker 容器。image 文件可以看作是容器的模板。Docker 根据 image 文件生成容器的实例。同一个 image 文件，可以生成多个同时运行的容器实例。image 是二进制文件。实际开发中，一个 image 文件往往通过继承另一个 image 文件，加上一些个性化设置而生成。**在 Docker 中我们可以通过 Dockerfile 创建 Dockerimage。** Dockerfile 是一个文本文件，用来配置 image。Docker 根据该文件生成二进制的 image 文件。

**下面是一个示例，演示了如何构建 Docker file 以生成 image**



## 1.3 镜像和发布镜像（Images and publishing images）
Docker Hub是一个由Docker提供的托管仓库服务，里边包含有很多平时用的较多的镜像。用户可以直接从 DockerHub下载镜像，还也可以将自己自定义的镜像push到 DockerHub 上。通过Docker Hub，你可以轻松地交付任何应用程序，并使你的应用程序可以被你的团队访问。

**下面是一个示例，演示了如何将 image push到 DockerHub**

## 1.4 容器卷（Container volumes）
[Docker Volume 看这一篇就够了-阿里云开发者社区 (aliyun.com)](https://developer.aliyun.com/article/1113502)
默认情况下，在容器内创建的所有文件都存储在可写容器层上。这意味着：当该容器不再存在时，数据不会持续存在，并且如果另一个进程需要数据，则可能很难将数据从容器中取出。容器的可写层与运行容器的主机紧密耦合。您无法轻松地将数据移动到其他地方。写入容器的可写层需要 存储驱动程序来管理文件系统。存储驱动程序提供了一个联合文件系统，使用 Linux内核。与使用直接写入主机文件系统的数据卷相比，这种额外的抽象会降低性能 。

Docker 有两个选项让容器在主机上存储文件，以便即使在容器停止后文件也能持久保存：volumes和 bind mounts。Docker 还支持将文件存储在主机内存中的容器。此类文件不会持久保存。如果您在 Linux 上运行 Docker，则使用tmpfs mount将文件存储在主机的系统内存中。

本节主要探讨 Container volume，简单来说，通过Container volume 可以持久保存容器创建的数据，方便在容器之间共享数据。
![[Pasted image 20240420094702.png]]
>Docker 的存储

**下面是一个示例，演示了如何创建 Container volume**

## 1.5 .5 容器网络（Container networking）
[【Docker】Docker中network的概要、常用命令、网络模式以及底层ip和容器映射变化的详细讲解-阿里云开发者社区 (aliyun.com)](https://developer.aliyun.com/article/1314166)
在实际工程中，我们往往有多个容器，容器之间需要相互访问，Docker通过Docker Network实现容器之间的相互访问。Docker网络模型包括三个主要组件：容器、网络和端点。容器是运行应用程序的独立环境，网络提供容器之间和容器与外部世界之间的通信路径，而端点则是连接容器和网络的桥梁。 Docker支持多种网络类型，包括桥接网络、主机网络、覆盖网络和无网络。桥接网络是默认的网络类型，它使用Docker daemon主机上的桥接接口将容器连接到主机网络。主机网络直接将容器连接到主机网络接口，使得容器可以直接访问主机上的网络资源。覆盖网络是多个Docker守护进程连接在一起的虚拟网络，它允许容器在不同主机上进行通信。无网络类型则表示容器没有网络访问能力。 Docker提供了一组命令来管理和配置网络。

**下面是一个示例，演示了如何创建 Container Network**
# 2 云计算
[负载均衡 产品概述-产品简介-文档中心-腾讯云 (tencent.com)](https://cloud.tencent.com/document/product/214/524)
云计算的三个主要概念是load balancing, scalability and application gateways，下面我将以腾讯云为例，阐述与这三个概念相关的问题。
腾讯云是腾讯旗下的云计算服务商，为企业和开发者提供计算、存储、数据库、网络、大数据、视频、游戏等多种云服务，以及音视频、互动直播、在线教育等行业。
## 2.1 简要描述云提供商实现上述每个概念的方法

**负载均衡的实现：**

[负载均衡 产品概述-产品简介-文档中心-腾讯云 (tencent.com)](https://cloud.tencent.com/document/product/214/524)

负载均衡是一项服务，它根据需求将流量分配到不同的后端服务器，以增强应用系统的吞吐能力。同时，它还能够消除系统中的单点故障，提高应用系统的可用性。

腾讯云提供的负载均衡服务具备自助管理、自助故障修复，防网络攻击等高级功能，适用于企业、社区、电子商务、游戏等多种用户场景。一个提供服务的负载均衡组通常由以下部分组成：Cloud Load Balancer（负载均衡器）、Load Balance Listener（Load Balance Listener）、Real Server（后端服务器）。

负载均衡器接受来自客户端的传入流量，并将请求路由到一个或多个可用区的后端服务器实例上进行处理。

负载均衡服务主要由负载均衡监听器提供。监听器负责监听负载均衡实例上的请求、执行策略分发至后端服务器等服务，通过配置**客户端 - 负载均衡**和**负载均衡 - 后端服务器**两个维度的转发协议及协议端口，负载均衡可以将请求直接转发到后端服务器上。

可以跨多个可用区配置负载均衡器的后端服务器实例。如果一个可用区变得不可用，负载均衡器会将流量路由到其他可用区正常运行的实例上去，从而避免可用区故障引起的服务中断问题

**可扩展性的实现：**
[弹性伸缩 为伸缩组设置固定出口 IP-最佳实践-文档中心-腾讯云 (tencent.com)](https://cloud.tencent.com/document/product/377/8779)
[1.4 可扩展性（Scalability） - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/168757826)

腾讯云的弹性伸缩（Auto Scaling，AS）是提供给用户的高效管理计算资源的策略。您可设定时间周期性地执行管理策略或创建实时监控策略，来根据实时需求自动增加或减少 CVM 实例数量，同时完成实例的环境部署，保证业务平稳运行和最大程度的降低成本。 弹性伸缩策略不仅能够让需求稳定规律的应用程序实现自动化管理，同时告别业务突增或 CC 攻击等带来的烦恼，对于需求不规律的应用程序，还能够根据业务负载分钟级扩展。弹性伸缩策略能够让您的集群在任何时间都保持恰到好处的实例数量。



**应用程序网关：**
[API 网关_API Gateway_API 托管服务_API 管理_开放 API (tencent.com)](https://cloud.tencent.com/product/apigw#:~:text=%E8%85%BE%E8%AE%AF%E4%BA%91%20API%20%E7%BD%91%E5%85%B3%EF%BC%88API%20Gateway%EF%BC%89%E6%98%AF%E8%85%BE%E8%AE%AF%E4%BA%91%E6%8E%A8%E5%87%BA%E7%9A%84%E4%B8%80%E7%A7%8D,API%20%E6%89%98%E7%AE%A1%E6%9C%8D%E5%8A%A1%EF%BC%8C%E8%83%BD%E6%8F%90%E4%BE%9B%20API%20%E7%9A%84%E5%AE%8C%E6%95%B4%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86%EF%BC%8C%E5%8C%85%E6%8B%AC%E5%88%9B%E5%BB%BA%E3%80%81%E7%BB%B4%E6%8A%A4%E3%80%81%E5%8F%91%E5%B8%83%E3%80%81%E8%BF%90%E8%A1%8C%E3%80%81%E4%B8%8B%E7%BA%BF%E7%AD%89%E3%80%82)
腾讯云 API 网关（API Gateway）是腾讯云推出的一种 API 托管服务，能提供 API 的完整生命周期管理，包括创建、维护、发布、运行、下线等。
API 网关是用于实现完整 API 托管的服务，用于协助开发者轻松完成 API 的创建、维护、发布、监控等整个生命周期的管理。通过 API 网关，您可以封装后端各种服务，以 API 的形式，提供给各方使用。同时，API 网关协助您完成 API 文档管理、API 测试和 SDK 生成等。

![](https://qcloudimg.tencent-cloud.cn/image/document/8c96537bc5f508f716b00f685691b3de.png)
# 3 为什么相辅相成

弹性伸缩 AS（Auto Scaling）可以根据您的业务需求和策略，自动调整 CVM 计算资源，确保您拥有适量的 CVM 实例来处理您的应用程序负载。对于您的 Web 服务而言，智能的扩展和收缩是成本控制和资源管理的重要组成部分。Web 应用程序开始获得更多请求流量时，您将添加更多的服务器来应对额外负载。同时，当 Web 应用程序的流量开始减少时，您将终止未充分利用的服务器。

如果使用 AS 进行容量调整，您只需事先设置好扩容条件及缩容条件。AS 会在达到条件时自动增加使用的服务器数量以维护性能；在需求下降时，AS 会根据您的缩容条件减少服务器数量，最大限度地帮助您降低成本。